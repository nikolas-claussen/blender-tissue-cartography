<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>e_morphsnakes – blender-tissue-cartography</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-0652833b129a4aecb7d8777fd89a11f4.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
<meta property="og:title" content="blender-tissue-cartography">
<meta property="og:description" content="Pipeline for tissue extraction and analysis of surfaces from volumetric mircroscopy data using blender">
<meta property="og:site_name" content="blender-tissue-cartography">
<meta name="twitter:title" content="blender-tissue-cartography">
<meta name="twitter:description" content="Pipeline for tissue extraction and analysis of surfaces from volumetric mircroscopy data using blender">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">blender-tissue-cartography</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../Python library/io.html">Python library</a></li><li class="breadcrumb-item"><a href="../Python library/01e_morphsnakes.html">Morphsnakes segmentation</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">blender-tissue-cartography</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../00_tissue_cartography_overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tissue cartography with <code>blender_tisssue_cartography</code></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01_blender_addon.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Blender add-on</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Python library</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Python library/io.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Image I/O</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Python library/01b_mesh.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mesh data structure</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Python library/01c_interface_pymeshlab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><code>pymeshlab</code> interface</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Python library/01d_interface_trimesh.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><code>trimesh</code> interface</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Python library/01e_morphsnakes.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Morphsnakes segmentation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Python library/02_cartographic_interpolation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Cartographic interpolation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Python library/differential_geometry.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Surface differential geometry</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Python library/remeshing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mesh creation and remeshing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Python library/remeshing_pymeshlab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mesh creation and remeshing with MeshLab</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Python library/04c_smoothing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mesh smoothing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Python library/registration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Rigid-body registration</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Python library/registration_rotation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3D-rotation registration</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Python library/05c_wrapping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Shrink-wrapping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Python library/06_harmonic_wrapping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Harmonic mapping</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Tutorials/01_segmentation_with_ilastik.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1. 3d segmentation with Ilastik</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Tutorials/02_blender_tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2. Blender tutorial</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Tutorials/03_blender_addon_tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3. <code>blender_tissue_cartography</code> blender add-on</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Tutorials/04_btc_python_library.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4. <code>blender_tissue_cartography</code> Python library</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Tutorials/05_UV_maps_with_seams.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5. Tissue cartography with “seams”</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Tutorials/06_improving_UV_maps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">6. Iteratively improving cartographic projections</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Tutorials/07_advanced_segmentation_and_meshing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">7. Advanced segmentation and meshing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Tutorials/08_multiple_recordings_and_reference_meshes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">8. Consistent cartographic projections across multiple recordings</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Tutorials/09_movies_and_dynamic_surfaces.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">9. Time-lapse imaging and dynamic surfaces</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Tutorials/10_analysis_in_3d.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">10. 3D Image analysis with cartographic projections</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#morphsnakes-segmentation" id="toc-morphsnakes-segmentation" class="nav-link active" data-scroll-target="#morphsnakes-segmentation">Morphsnakes segmentation</a>
  <ul class="collapse">
  <li><a href="#morphological-snakes" id="toc-morphological-snakes" class="nav-link" data-scroll-target="#morphological-snakes">Morphological Snakes</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a>
  <ul class="collapse">
  <li><a href="#morphological_geodesic_active_contour" id="toc-morphological_geodesic_active_contour" class="nav-link" data-scroll-target="#morphological_geodesic_active_contour">morphological_geodesic_active_contour</a></li>
  <li><a href="#morphological_chan_vese" id="toc-morphological_chan_vese" class="nav-link" data-scroll-target="#morphological_chan_vese">morphological_chan_vese</a></li>
  <li><a href="#inverse_gaussian_gradient" id="toc-inverse_gaussian_gradient" class="nav-link" data-scroll-target="#inverse_gaussian_gradient">inverse_gaussian_gradient</a></li>
  <li><a href="#checkerboard_level_set" id="toc-checkerboard_level_set" class="nav-link" data-scroll-target="#checkerboard_level_set">checkerboard_level_set</a></li>
  <li><a href="#ellipsoid_level_set" id="toc-ellipsoid_level_set" class="nav-link" data-scroll-target="#ellipsoid_level_set">ellipsoid_level_set</a></li>
  <li><a href="#circle_level_set" id="toc-circle_level_set" class="nav-link" data-scroll-target="#circle_level_set">circle_level_set</a></li>
  <li><a href="#inf_sup" id="toc-inf_sup" class="nav-link" data-scroll-target="#inf_sup">inf_sup</a></li>
  <li><a href="#sup_inf" id="toc-sup_inf" class="nav-link" data-scroll-target="#sup_inf">sup_inf</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/nikolas-claussen/blender-tissue-cartography/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../Python library/io.html">Python library</a></li><li class="breadcrumb-item"><a href="../Python library/01e_morphsnakes.html">Morphsnakes segmentation</a></li></ol></nav></header>




<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<section id="morphsnakes-segmentation" class="level2">
<h2 class="anchored" data-anchor-id="morphsnakes-segmentation">Morphsnakes segmentation</h2>
<blockquote class="blockquote">
<p>Morphological snakes algorithm for 3D image segmentation. Source: https://github.com/pmneila/morphsnakes</p>
</blockquote>
<p>This code was written by P. Márquez Neila <a href="mailto:p.mneila@upm.es" class="email">p.mneila@upm.es</a> and is included in this repository for ease of installation.</p>
<p>LICENSE</p>
<p>Copyright (c) 2013-2015, P. M. Neila All rights reserved.</p>
<p>Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</p>
<ul>
<li><p>Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</p></li>
<li><p>Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</p></li>
<li><p>Neither the name of morphsnakes nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</p></li>
</ul>
<p>THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS “AS IS” AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</p>
<section id="morphological-snakes" class="level3">
<h3 class="anchored" data-anchor-id="morphological-snakes">Morphological Snakes</h3>
<p><em>Morphological Snakes</em> [1]_ are a family of methods for image segmentation. Their behavior is similar to that of active contours (for example, <em>Geodesic Active Contours</em> [2]_ or <em>Active Contours without Edges</em> [3]_). However, <em>Morphological Snakes</em> use morphological operators (such as dilation or erosion) over a binary array instead of solving PDEs over a floating point array, which is the standard approach for active contours. This makes <em>Morphological Snakes</em> faster and numerically more stable than their traditional counterpart.</p>
<p>There are two <em>Morphological Snakes</em> methods available in this implementation: <em>Morphological Geodesic Active Contours</em> (<strong>MorphGAC</strong>, implemented in the function <code>[</code>morphological_geodesic_active_contour<code>](https://nikolas-claussen.github.io/blender-tissue-cartography/Python library/morphsnakes.html#morphological_geodesic_active_contour)</code>) and <em>Morphological Active Contours without Edges</em> (<strong>MorphACWE</strong>, implemented in the function <code>[</code>morphological_chan_vese<code>](https://nikolas-claussen.github.io/blender-tissue-cartography/Python library/morphsnakes.html#morphological_chan_vese)</code>).</p>
<p><strong>MorphGAC</strong> is suitable for images with visible contours, even when these contours might be noisy, cluttered, or partially unclear. It requires, however, that the image is preprocessed to highlight the contours. This can be done using the function <code>[</code>inverse_gaussian_gradient<code>](https://nikolas-claussen.github.io/blender-tissue-cartography/Python library/morphsnakes.html#inverse_gaussian_gradient)</code>, although the user might want to define their own version. The quality of the <strong>MorphGAC</strong> segmentation depends greatly on this preprocessing step.</p>
<p>On the contrary, <strong>MorphACWE</strong> works well when the pixel values of the inside and the outside regions of the object to segment have different averages. Unlike <strong>MorphGAC</strong>, <strong>MorphACWE</strong> does not require that the contours of the object are well defined, and it works over the original image without any preceding processing. This makes <strong>MorphACWE</strong> easier to use and tune than <strong>MorphGAC</strong>.</p>
</section>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<p>[1] A Morphological Approach to Curvature-based Evolution of Curves and Surfaces, Pablo Márquez-Neila, Luis Baumela and Luis Álvarez. In IEEE Transactions on Pattern Analysis and Machine Intelligence (PAMI), 2014, DOI 10.1109/TPAMI.2013.106</p>
<p>[2] Geodesic Active Contours, Vicent Caselles, Ron Kimmel and Guillermo Sapiro. In International Journal of Computer Vision (IJCV), 1997, DOI:10.1023/A:1007979827043</p>
<p>[3] Active Contours without Edges, Tony Chan and Luminita Vese. In IEEE Transactions on Image Processing, 2001, DOI:10.1109/83.902291</p>
<pre><code>/opt/hostedtoolcache/Python/3.10.16/x64/lib/python3.10/site-packages/fastcore/docscrape.py:230: UserWarning: Unknown section See Also
  else: warn(msg)</code></pre>
<hr>
<p><a href="https://github.com/nikolas-claussen/blender-tissue-cartography/blob/main/blender_tissue_cartography/morphsnakes.py#L390" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="morphological_geodesic_active_contour" class="level3">
<h3 class="anchored" data-anchor-id="morphological_geodesic_active_contour">morphological_geodesic_active_contour</h3>
<blockquote class="blockquote">
<pre><code> morphological_geodesic_active_contour (gimage, iterations,
                                        init_level_set='circle',
                                        smoothing=1, threshold='auto',
                                        balloon=0, iter_callback=&lt;function
                                        &lt;lambda&gt;&gt;)</code></pre>
</blockquote>
<p>*Morphological Geodesic Active Contours (MorphGAC).</p>
<p>Geodesic active contours implemented with morphological operators. It can be used to segment objects with visible but noisy, cluttered, broken borders.*</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>gimage</td>
<td>(M, N) or (L, M, N) array</td>
<td></td>
<td>Preprocessed image or volume to be segmented. This is very rarely the<br>original image. Instead, this is usually a preprocessed version of the<br>original image that enhances and highlights the borders (or other<br>structures) of the object to segment.<br><a href="https://nikolas-claussen.github.io/blender-tissue-cartography/Python%20library/morphsnakes.html#morphological_geodesic_active_contour"><code>morphological_geodesic_active_contour</code></a> will try to stop the contour<br>evolution in areas where <code>gimage</code> is small. See<br><code>morphsnakes.inverse_gaussian_gradient</code> as an example function to<br>perform this preprocessing. Note that the quality of<br><a href="https://nikolas-claussen.github.io/blender-tissue-cartography/Python%20library/morphsnakes.html#morphological_geodesic_active_contour"><code>morphological_geodesic_active_contour</code></a> might greatly depend on this<br>preprocessing.</td>
</tr>
<tr class="even">
<td>iterations</td>
<td>uint</td>
<td></td>
<td>Number of iterations to run.</td>
</tr>
<tr class="odd">
<td>init_level_set</td>
<td>str</td>
<td>circle</td>
<td>Initial level set. If an array is given, it will be binarized and used<br>as the initial level set. If a string is given, it defines the method<br>to generate a reasonable initial level set with the shape of the<br><code>image</code>. Accepted values are ‘checkerboard’ and ‘circle’. See the<br>documentation of <a href="https://nikolas-claussen.github.io/blender-tissue-cartography/Python%20library/morphsnakes.html#checkerboard_level_set"><code>checkerboard_level_set</code></a> and <a href="https://nikolas-claussen.github.io/blender-tissue-cartography/Python%20library/morphsnakes.html#circle_level_set"><code>circle_level_set</code></a><br>respectively for details about how these level sets are created.</td>
</tr>
<tr class="even">
<td>smoothing</td>
<td>int</td>
<td>1</td>
<td>Number of times the smoothing operator is applied per iteration.<br>Reasonable values are around 1-4. Larger values lead to smoother<br>segmentations.</td>
</tr>
<tr class="odd">
<td>threshold</td>
<td>str</td>
<td>auto</td>
<td>Areas of the image with a value smaller than this threshold will be<br>considered borders. The evolution of the contour will stop in this<br>areas.</td>
</tr>
<tr class="even">
<td>balloon</td>
<td>int</td>
<td>0</td>
<td>Balloon force to guide the contour in non-informative areas of the<br>image, i.e., areas where the gradient of the image is too small to push<br>the contour towards a border. A negative value will shrink the contour,<br>while a positive value will expand the contour in these areas. Setting<br>this to zero will disable the balloon force.</td>
</tr>
<tr class="odd">
<td>iter_callback</td>
<td>function</td>
<td><lambda></lambda></td>
<td>If given, this function is called once per iteration with the current<br>level set as the only argument. This is useful for debugging or for<br>plotting intermediate results during the evolution.</td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>(M, N) or (L, M, N) array</strong></td>
<td></td>
<td><strong>Final segmentation (i.e., the final level set)</strong></td>
</tr>
</tbody>
</table>
<hr>
<p><a href="https://github.com/nikolas-claussen/blender-tissue-cartography/blob/main/blender_tissue_cartography/morphsnakes.py#L286" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="morphological_chan_vese" class="level3">
<h3 class="anchored" data-anchor-id="morphological_chan_vese">morphological_chan_vese</h3>
<blockquote class="blockquote">
<pre><code> morphological_chan_vese (image, iterations,
                          init_level_set='checkerboard', smoothing=1,
                          lambda1=1, lambda2=1, iter_callback=&lt;function
                          &lt;lambda&gt;&gt;)</code></pre>
</blockquote>
<p>*Morphological Active Contours without Edges (MorphACWE)</p>
<p>Active contours without edges implemented with morphological operators. It can be used to segment objects in images and volumes without well defined borders. It is required that the inside of the object looks different on average than the outside (i.e., the inner area of the object should be darker or lighter than the outer area on average).*</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>image</td>
<td>(M, N) or (L, M, N) array</td>
<td></td>
<td>Grayscale image or volume to be segmented.</td>
</tr>
<tr class="even">
<td>iterations</td>
<td>uint</td>
<td></td>
<td>Number of iterations to run</td>
</tr>
<tr class="odd">
<td>init_level_set</td>
<td>str</td>
<td>checkerboard</td>
<td>Initial level set. If an array is given, it will be binarized and used<br>as the initial level set. If a string is given, it defines the method<br>to generate a reasonable initial level set with the shape of the<br><code>image</code>. Accepted values are ‘checkerboard’ and ‘circle’. See the<br>documentation of <a href="https://nikolas-claussen.github.io/blender-tissue-cartography/Python%20library/morphsnakes.html#checkerboard_level_set"><code>checkerboard_level_set</code></a> and <a href="https://nikolas-claussen.github.io/blender-tissue-cartography/Python%20library/morphsnakes.html#circle_level_set"><code>circle_level_set</code></a><br>respectively for details about how these level sets are created.</td>
</tr>
<tr class="even">
<td>smoothing</td>
<td>int</td>
<td>1</td>
<td>Number of times the smoothing operator is applied per iteration.<br>Reasonable values are around 1-4. Larger values lead to smoother<br>segmentations.</td>
</tr>
<tr class="odd">
<td>lambda1</td>
<td>int</td>
<td>1</td>
<td>Weight parameter for the outer region. If <code>lambda1</code> is larger than<br><code>lambda2</code>, the outer region will contain a larger range of values than<br>the inner region.</td>
</tr>
<tr class="even">
<td>lambda2</td>
<td>int</td>
<td>1</td>
<td>Weight parameter for the inner region. If <code>lambda2</code> is larger than<br><code>lambda1</code>, the inner region will contain a larger range of values than<br>the outer region.</td>
</tr>
<tr class="odd">
<td>iter_callback</td>
<td>function</td>
<td><lambda></lambda></td>
<td>If given, this function is called once per iteration with the current<br>level set as the only argument. This is useful for debugging or for<br>plotting intermediate results during the evolution.</td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>(M, N) or (L, M, N) array</strong></td>
<td></td>
<td><strong>Final segmentation (i.e., the final level set)</strong></td>
</tr>
</tbody>
</table>
<hr>
<p><a href="https://github.com/nikolas-claussen/blender-tissue-cartography/blob/main/blender_tissue_cartography/morphsnakes.py#L254" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="inverse_gaussian_gradient" class="level3">
<h3 class="anchored" data-anchor-id="inverse_gaussian_gradient">inverse_gaussian_gradient</h3>
<blockquote class="blockquote">
<pre><code> inverse_gaussian_gradient (image, alpha=100.0, sigma=5.0)</code></pre>
</blockquote>
<p>*Inverse of gradient magnitude.</p>
<p>Compute the magnitude of the gradients in the image and then inverts the result in the range [0, 1]. Flat areas are assigned values close to 1, while areas close to borders are assigned values close to 0.</p>
<p>This function or a similar one defined by the user should be applied over the image as a preprocessing step before calling <a href="https://nikolas-claussen.github.io/blender-tissue-cartography/Python%20library/morphsnakes.html#morphological_geodesic_active_contour"><code>morphological_geodesic_active_contour</code></a>.*</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>image</td>
<td>(M, N) or (L, M, N) array</td>
<td></td>
<td>Grayscale image or volume.</td>
</tr>
<tr class="even">
<td>alpha</td>
<td>float</td>
<td>100.0</td>
<td>Controls the steepness of the inversion. A larger value will make the<br>transition between the flat areas and border areas steeper in the<br>resulting array.</td>
</tr>
<tr class="odd">
<td>sigma</td>
<td>float</td>
<td>5.0</td>
<td>Standard deviation of the Gaussian filter applied over the image.</td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>(M, N) or (L, M, N) array</strong></td>
<td></td>
<td><strong>Preprocessed image (or volume) suitable for<br><a href="https://nikolas-claussen.github.io/blender-tissue-cartography/Python%20library/morphsnakes.html#morphological_geodesic_active_contour"><code>morphological_geodesic_active_contour</code></a>.</strong></td>
</tr>
</tbody>
</table>
<hr>
<p><a href="https://github.com/nikolas-claussen/blender-tissue-cartography/blob/main/blender_tissue_cartography/morphsnakes.py#L226" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="checkerboard_level_set" class="level3">
<h3 class="anchored" data-anchor-id="checkerboard_level_set">checkerboard_level_set</h3>
<blockquote class="blockquote">
<pre><code> checkerboard_level_set (image_shape, square_size=5)</code></pre>
</blockquote>
<p><em>Create a checkerboard level set with binary values.</em></p>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>image_shape</td>
<td>tuple of positive integers</td>
<td></td>
<td>Shape of the image.</td>
</tr>
<tr class="even">
<td>square_size</td>
<td>int</td>
<td>5</td>
<td>Size of the squares of the checkerboard. It defaults to 5.</td>
</tr>
<tr class="odd">
<td><strong>Returns</strong></td>
<td><strong>array with shape <code>image_shape</code></strong></td>
<td></td>
<td><strong>Binary level set of the checkerboard.</strong></td>
</tr>
</tbody>
</table>
<hr>
<p><a href="https://github.com/nikolas-claussen/blender-tissue-cartography/blob/main/blender_tissue_cartography/morphsnakes.py#L167" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="ellipsoid_level_set" class="level3">
<h3 class="anchored" data-anchor-id="ellipsoid_level_set">ellipsoid_level_set</h3>
<blockquote class="blockquote">
<pre><code> ellipsoid_level_set (image_shape, center=None, semi_axis=None)</code></pre>
</blockquote>
<p><em>Create a ellipsoid level set with binary values.</em></p>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>image_shape</td>
<td>tuple of positive integers</td>
<td></td>
<td>Shape of the image</td>
</tr>
<tr class="even">
<td>center</td>
<td>NoneType</td>
<td>None</td>
<td>Coordinates of the center of the ellipsoid.<br>If not given, it defaults to the center of the image.</td>
</tr>
<tr class="odd">
<td>semi_axis</td>
<td>NoneType</td>
<td>None</td>
<td>Lengths of the semi-axis of the ellispoid.<br>If not given, it defaults to the half of the image dimensions.</td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>array with shape <code>image_shape</code></strong></td>
<td></td>
<td><strong>Binary level set of the ellipsoid with the given <code>center</code><br>and <code>semi_axis</code>.</strong></td>
</tr>
</tbody>
</table>
<hr>
<p><a href="https://github.com/nikolas-claussen/blender-tissue-cartography/blob/main/blender_tissue_cartography/morphsnakes.py#L129" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="circle_level_set" class="level3">
<h3 class="anchored" data-anchor-id="circle_level_set">circle_level_set</h3>
<blockquote class="blockquote">
<pre><code> circle_level_set (image_shape, center=None, radius=None)</code></pre>
</blockquote>
<p><em>Create a circle level set with binary values.</em></p>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>image_shape</td>
<td>tuple of positive integers</td>
<td></td>
<td>Shape of the image</td>
</tr>
<tr class="even">
<td>center</td>
<td>NoneType</td>
<td>None</td>
<td>Coordinates of the center of the circle given in (row, column). If not<br>given, it defaults to the center of the image.</td>
</tr>
<tr class="odd">
<td>radius</td>
<td>NoneType</td>
<td>None</td>
<td>Radius of the circle. If not given, it is set to the 75% of the<br>smallest image dimension.</td>
</tr>
<tr class="even">
<td><strong>Returns</strong></td>
<td><strong>array with shape <code>image_shape</code></strong></td>
<td></td>
<td><strong>Binary level set of the circle with the given <code>radius</code> and <code>center</code>.</strong></td>
</tr>
</tbody>
</table>
<hr>
<p><a href="https://github.com/nikolas-claussen/blender-tissue-cartography/blob/main/blender_tissue_cartography/morphsnakes.py#L77" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="inf_sup" class="level3">
<h3 class="anchored" data-anchor-id="inf_sup">inf_sup</h3>
<blockquote class="blockquote">
<pre><code> inf_sup (u)</code></pre>
</blockquote>
<p><em>IS operator.</em></p>
<hr>
<p><a href="https://github.com/nikolas-claussen/blender-tissue-cartography/blob/main/blender_tissue_cartography/morphsnakes.py#L59" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="sup_inf" class="level3">
<h3 class="anchored" data-anchor-id="sup_inf">sup_inf</h3>
<blockquote class="blockquote">
<pre><code> sup_inf (u)</code></pre>
</blockquote>
<p><em>SI operator.</em></p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/nikolas-claussen\.github\.io\/blender-tissue-cartography");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/nikolas-claussen/blender-tissue-cartography/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>